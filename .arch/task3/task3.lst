GAS LISTING task3.S 			page 1


   1              	/*
   2              	 * –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤–≤–æ–¥–∞ –∫–æ–¥–æ–≤ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –≤ –±—É—Ñ–µ—Ä –∏ –≤—ã
   3              	 */
   4              	
   5              	.include "my-macro"
   1              	/* 
   2              	 * –ú–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.
   3              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
   4              	 * 	- –∫–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã
   5              	 *
   6              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
   7              	 * –°–º. —Ç–∞–∫–∂–µ 'man 2 exit'
   8              	*/
   9              	.macro Exit ret_val
  10              		movl $1, %eax 		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ exit
  11              		movl \ret_val, %ebx 	# –∫–æ–¥ –≤—ã—Ö–æ–¥–∞
  12              		int $0x80 		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  13              	.endm
  14              	
  15              	
  16              	/*
  17              	 * –ú–∞—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ —Å–∏–
  18              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  19              	 * 	- –∞–¥—Ä–µ—Å –±—É—Ñ—Ñ–µ—Ä–∞ –¥–ª—è —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è —Å–∏–º–≤–æ–ª–∞
  20              	 * –†–µ–∑—É–ª—å—Ç–∞—Ç:
  21              	 *	- –≤ %eax –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
  22              	 *	- –ø–æ –∞–¥—Ä–µ—Å—É buf_addr - —Å—á–∏—Ç–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª
  23              	 * 
  24              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  25              	 * –°–º. —Ç–∞–∫–∂–µ 'man 2 read'
  26              	*/
  27              	.macro Getchar buf_addr
  28              		movl $3, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ read
  29              		movl $0, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤–≤–æ–¥–∞
  30              		movl \buf_addr, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ (–æ–Ω –∂–µ - —Ñ–∞–∫—Ç–∏—á–µ—Å–∫
  31              		     			# –ø–∞—Ä–∞–º–µ—Ç—Ä –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞)
  32              		movl $1, %edx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è —á—Ç–µ–Ω–∏—è
  33              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  34              	.endm
  35              	
  36              	/*
  37              	 * –ú–∞—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤—ã–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ –≤ —Å—Ç–∞–Ω–¥
  38              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  39              	 * 	- –°—Ç—Ä–æ–∫–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞.
  40              	 *
  41              	 * –ü—Ä–∏–º–µ—Ç—Ä –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞:
  42              	 *	Puts "–¢–µ–∫—Å—Ç –≤—ã–≤–æ–¥–∏–º–æ–π —Å—Ç—Ä–æ–∫–∏" 
  43              	 *
  44              	 * –†–µ–∑—É–ª—å—Ç–∞—Ç:
  45              	 *	- –≤—ã–≤–æ–¥–∏—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ —Å–∏–º–≤–æ–ª—ã –∑–∞–¥–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫
  46              	 *	  –∞ —Ç–∞–∫–∂–µ —Å–∏–º–≤–æ–ª –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏
  47              	 *	
  48              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  49              	 * –°–º. —Ç–∞–∫–∂–µ 'man puts', 'man 2 write'
  50              	*/
  51              	.macro Puts string
  52              	.data
GAS LISTING task3.S 			page 2


  53              	    str\@: 	.ascii "\string\n"  # —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª
  54              		
  55              	    strlen\@ = 	. - str\@           # –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫–∏
  56              	
  57              	.text
  58              		movl $4, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ write
  59              		movl $1, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞	
  60              		movl $str\@, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏ —Å –≤—ã–≤–æ–¥–∏–º—ã–º–∏ —Å–∏–º–≤–æ
  61              		movl $strlen\@, %edx 	# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞
  62              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  63              	.endm
  64              	
   6              	
   7              	.bss
   8              	    .lcomm buf, 100 # –±—É—Ñ–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤. –
   9              	    .lcomm c, 1	# –±—É—Ñ–µ—Ä –¥–ª—è —á—Ç–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞. –†–∞–∑–º–µ—Ä - 1 
  10              		
  11              	.text
  12              	.global _start
  13              	
  14              	_start:
  15 0000 29F6     	    sub	%esi, %esi     # —É–∫–∞–∑–∞—Ç–µ–ª—å –∞–¥—Ä–µ—Å–∞ –±–∞–π—Ç–∞ –≤ –±—É—Ñ–µ—Ä–µ —Å–∏–º–≤–æ–ª–æ–
  16              	    
  17              	show_prompt:
  18              	    Puts "–í–≤–æ–¥–∏—Ç–µ —Ü–∏—Ñ—Ä—É, –¥—Ä—É–≥ –º–æ–π!" 	# –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤ –≤—ã–≤–æ–¥–∞ —Å—Ç—Ä–
  18              	> .data
  18 0000 D092D0B2 	>  str0:.ascii "–í–≤–æ–¥–∏—Ç–µ —Ü–∏—Ñ—Ä—É, –¥—Ä—É–≥ –º–æ–π!\n"
  18      D0BED0B4 
  18      D0B8D182 
  18      D0B520D1 
  18      86D0B8D1 
  18              	>  
  18              	>  strlen0 =. - str0
  18              	> 
  18              	> .text
  18 0002 B8040000 	>  movl $4,%eax
  18      00
  18 0007 BB010000 	>  movl $1,%ebx
  18      00
  18 000c B9000000 	>  movl $str0,%ecx
  18      00
  18 0011 BA2C0000 	>  movl $strlen0,%edx
  18      00
  18 0016 CD80     	>  int $0x80
  19              						# –≤—ã–≤–æ–¥ (–ø–æ–¥—Å–∫–∞–∑–∫–∞ –≤–≤–æ–¥–∞)
  20              	
  21              	kbd_input:
  22              	    Getchar $c          # –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤ –≤–≤–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–
  22 0018 B8030000 	>  movl $3,%eax
  22      00
  22 001d BB000000 	>  movl $0,%ebx
  22      00
  22 0022 B9640000 	>  movl $c,%ecx
  22      00
  22              	>  
  22 0027 BA010000 	>  movl $1,%edx
  22      00
GAS LISTING task3.S 			page 3


  22 002c CD80     	>  int $0x80
  23              	    
  24 002e 83F800   	    cmpl $0, %eax 	# –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª - EOF (–≤–≤–µ–¥–µ–Ω–æ 0 —Å–∏–º–≤–æ–ª–æ–≤) ? 
  25 0031 745F     	    je stop		# –î–∞ - –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
  26              	    
  27 0033 803D6400 	    cmpb $'\n', c 	# —ç—Ç–æ —Å–∏–º–≤–æ–ª –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ ?
  27      00000A
  28 003a 747A     	    je eax_input 	# –î–ê - –Ω–∞ –≤—ã–≤–æ–¥ —Å–ª–µ–¥—É—é—â–µ–≥–æ–ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–∏–º–≤–æ–ª–
  29 003c 803D6400 	    cmpb $'9', c  	# –∫–æ–¥ –±–æ–ª—å—à–µ –∫–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ '9' ?
  29      000039
  30 0043 7732     	    ja print_err_msg	# –î–ê - –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
  31 0045 803D6400 	    cmpb $'0', c	# –∫–æ–¥ –º–µ–Ω—å—à–µ –∫–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ '0' ?
  31      000030
  32 004c 7229     	    jb print_err_msg	# –î–ê - –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
  33              	
  34 004e A0640000 	    movb c, %al         # –∫–æ–¥ –∏–∑ —Å –ø–∏—à–µ–º –≤ al
  34      00
  35              	
  36 0053 83FE64   	    cmpl $100, %esi	# –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º esi —Å —Å–æ—Ç–Ω–µ–π
  37 0056 7446     	    je print_end_buffer	# –ï—Å–ª–∏ –≤–µ—Ä–Ω–æ —Ç–æ –≤—ã–≤–æ–¥ –æ—à–∏–±–∫–∏ –æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ 
  38              		
  39 0058 88860000 	    movb %al, buf(%esi) # –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ al (–≤–≤–µ–¥–µ–Ω–Ω—ã–π —Å–∏–º–≤–æ
  39      0000
  40              				# –∞–¥—Ä–µ—Å—É buf + esi (–±—É—Ñ–µ—Ä –¥–ª—è –≤–≤–æ–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤)
  41 005e 46       	    incl %esi		# —É–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ –¥–ª—è —Å–ª–µ–¥—É—é
  42              	    Puts "–¶–∏—Ñ—Ä–∞! –•–æ—Ä–æ—à–æ." # –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º –≤–≤–æ–¥
  42              	> .data
  42 002c D0A6D0B8 	>  str2:.ascii "–¶–∏—Ñ—Ä–∞! –•–æ—Ä–æ—à–æ.\n"
  42      D184D180 
  42      D0B02120 
  42      D0A5D0BE 
  42      D180D0BE 
  42              	>  
  42              	>  strlen2 =. - str2
  42              	> 
  42              	> .text
  42 005f B8040000 	>  movl $4,%eax
  42      00
  42 0064 BB010000 	>  movl $1,%ebx
  42      00
  42 0069 B92C0000 	>  movl $str2,%ecx
  42      00
  42 006e BA1A0000 	>  movl $strlen2,%edx
  42      00
  42 0073 CD80     	>  int $0x80
  43              	    
  44 0075 EB8B     	    jmp show_prompt	# –Ω–∞ –≤–≤–æ–¥ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞
  45              	
  46              	print_err_msg:
  47              	    Puts "–ù–µ —Ü–∏—Ñ—Ä–æ–≤–∞—è –∫–ª–∞–≤–∏—à–∞. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –≤–≤–æ–¥"	# –≤—ã–≤–æ–¥ —Å–æ–æ–±—
  47              	> .data
  47 0046 D09DD0B5 	>  str3:.ascii "–ù–µ —Ü–∏—Ñ—Ä–æ–≤–∞—è –∫–ª–∞–≤–∏—à–∞. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –≤–≤–æ–¥\n"
  47      20D186D0 
  47      B8D184D1 
  47      80D0BED0 
  47      B2D0B0D1 
  47              	>  
GAS LISTING task3.S 			page 4


  47              	>  strlen3 =. - str3
  47              	> 
  47              	> .text
  47 0077 B8040000 	>  movl $4,%eax
  47      00
  47 007c BB010000 	>  movl $1,%ebx
  47      00
  47 0081 B9460000 	>  movl $str3,%ecx
  47      00
  47 0086 BA420000 	>  movl $strlen3,%edx
  47      00
  47 008b CD80     	>  int $0x80
  48 008d E970FFFF 	    jmp show_prompt 	# –Ω–∞ –≤–≤–æ–¥ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞
  48      FF
  49              	
  50              	stop:
  51              		Exit $0
  51 0092 B8010000 	>  movl $1,%eax
  51      00
  51 0097 BB000000 	>  movl $0,%ebx
  51      00
  51 009c CD80     	>  int $0x80
  52              	
  53              	print_end_buffer:
  54              		Puts "–ë—É—Ñ—Ñ–µ–µ—Ä –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω" # –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
  54              	> .data
  54 0088 D091D183 	>  str5:.ascii "–ë—É—Ñ—Ñ–µ–µ—Ä –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω\n"
  54      D184D184 
  54      D0B5D0B5 
  54      D18020D0 
  54      BFD0B5D1 
  54              	>  
  54              	>  strlen5 =. - str5
  54              	> 
  54              	> .text
  54 009e B8040000 	>  movl $4,%eax
  54      00
  54 00a3 BB010000 	>  movl $1,%ebx
  54      00
  54 00a8 B9880000 	>  movl $str5,%ecx
  54      00
  54 00ad BA240000 	>  movl $strlen5,%edx
  54      00
  54 00b2 CD80     	>  int $0x80
  55 00b4 EBDC     		jmp stop		  # –≤—ã—Ö–æ–¥ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã
  56              		
  57              	eax_input:
  58 00b6 89F3     		movl %esi,%ebx 		# –ö–æ–ø–∏—Ä—É–µ–º %esi –≤ %ebx
  59 00b8 4B       		decl %ebx		# –£–º–µ–Ω—å—à–∞–µ–º %ebx –Ω–∞ 1
  60 00b9 83FB00   		cmpl $0, %ebx 		# –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º %ebx —Å 0
  61 00bc 0F8C56FF 		jl kbd_input 		# –î–ê - –ø–µ—Ä–µ—Ö–æ–¥ –∫ –Ω–∞—á–∞–ª—É –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –≤–≤–æ–¥–∞ —Å–ª–µ
  61      FFFF
  62 00c2 8A830000 		movb buf(%ebx), %al	# –ö–æ–ø–∏—Ä—É–µ–º —è—á–µ–π–∫—É buf + %ebx –≤ %al
  62      0000
  63 00c8 2C30     		subb $0x30, %al		#
  64 00ca E949FFFF 		jmp kbd_input		#
  64      FF
GAS LISTING task3.S 			page 5


  65              	
  66              	
  67              	.end
GAS LISTING task3.S 			page 6


DEFINED SYMBOLS
             task3.S:8      .bss:0000000000000000 buf
             task3.S:8      .bss:0000000000000064 c
             task3.S:14     .text:0000000000000000 _start
             task3.S:17     .text:0000000000000002 show_prompt
             task3.S:18     .data:0000000000000000 str0
             task3.S:18     *ABS*:000000000000002c strlen0
             task3.S:21     .text:0000000000000018 kbd_input
             task3.S:50     .text:0000000000000092 stop
             task3.S:57     .text:00000000000000b6 eax_input
             task3.S:46     .text:0000000000000077 print_err_msg
             task3.S:53     .text:000000000000009e print_end_buffer
             task3.S:42     .data:000000000000002c str2
             task3.S:42     *ABS*:000000000000001a strlen2
             task3.S:47     .data:0000000000000046 str3
             task3.S:47     *ABS*:0000000000000042 strlen3
             task3.S:54     .data:0000000000000088 str5
             task3.S:54     *ABS*:0000000000000024 strlen5

NO UNDEFINED SYMBOLS
