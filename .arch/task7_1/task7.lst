GAS LISTING task7.S 			page 1


   1              	.include "my-macro"
   1              	// –ú–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã
   2              	
   3              	.macro Finish
   4              	    movl $0, %ebx 	# first argument: exit code
   5              	    movl $1, %eax 	# sys_exit index
   6              	    int  $0x80 		# kernel interrupt
   7              	.endm
   8              	
   9              	
  10              	/* 
  11              	 * –ú–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.
  12              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  13              	 * 	- –∫–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã
  14              	 *
  15              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  16              	 * –°–º. —Ç–∞–∫–∂–µ 'man 2 exit'
  17              	*/
  18              	.macro Exit ret_val
  19              		movl $1, %eax 		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ exit
  20              		movl \ret_val, %ebx 	# –∫–æ–¥ –≤—ã—Ö–æ–¥–∞
  21              		int $0x80 		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  22              	.endm
  23              	
  24              	
  25              	/*
  26              	 * –ú–∞—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ —Å–∏–
  27              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  28              	 * 	- –∞–¥—Ä–µ—Å –±—É—Ñ—Ñ–µ—Ä–∞ –¥–ª—è —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è —Å–∏–º–≤–æ–ª–∞
  29              	 * –†–µ–∑—É–ª—å—Ç–∞—Ç:
  30              	 *	- –≤ %eax –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
  31              	 *	- –ø–æ –∞–¥—Ä–µ—Å—É buf_addr - —Å—á–∏—Ç–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª
  32              	 * 
  33              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  34              	 * –°–º. —Ç–∞–∫–∂–µ 'man 2 read'
  35              	*/
  36              	.macro Getchar buf_addr
  37              		movl $3, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ read
  38              		movl $0, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤–≤–æ–¥–∞
  39              		movl \buf_addr, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ (–æ–Ω –∂–µ - —Ñ–∞–∫—Ç–∏—á–µ—Å–∫
  40              		     			# –ø–∞—Ä–∞–º–µ—Ç—Ä –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞)
  41              		movl $1, %edx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è —á—Ç–µ–Ω–∏—è
  42              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  43              	.endm
  44              	
  45              	/*
  46              	 * –ú–∞—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤—ã–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ –≤ —Å—Ç–∞–Ω–¥
  47              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  48              	 * 	- –°—Ç—Ä–æ–∫–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞.
  49              	 *
  50              	 * –ü—Ä–∏–º–µ—Ç—Ä –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞:
  51              	 *	Puts "–¢–µ–∫—Å—Ç –≤—ã–≤–æ–¥–∏–º–æ–π —Å—Ç—Ä–æ–∫–∏" 
  52              	 *
  53              	 * –†–µ–∑—É–ª—å—Ç–∞—Ç:
  54              	 *	- –≤—ã–≤–æ–¥–∏—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ —Å–∏–º–≤–æ–ª—ã –∑–∞–¥–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫
  55              	 *	  –∞ —Ç–∞–∫–∂–µ —Å–∏–º–≤–æ–ª –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏
  56              	 *	
GAS LISTING task7.S 			page 2


  57              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  58              	 * –°–º. —Ç–∞–∫–∂–µ 'man puts', 'man 2 write'
  59              	*/
  60              	.macro Puts string
  61              	.data
  62              	    str\@: 	.ascii "\string"  # —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª—è
  63              		
  64              	    strlen\@ = 	. - str\@           # –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫–∏
  65              	
  66              	.text
  67              		movl $4, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ write
  68              		movl $1, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞	
  69              		movl $str\@, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏ —Å –≤—ã–≤–æ–¥–∏–º—ã–º–∏ —Å–∏–º–≤–æ
  70              		movl $strlen\@, %edx 	# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞
  71              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  72              	.endm
  73              	
  74              	
  75              	
  76              	
  77              	
   2              	
   3              	.extern scanf	
   4              	.extern printf
   5              	
   6              	.data 
   7 0000 00000000 	get:	.long	0
   8 0004 00000000 	put:	.long	0
   9              	
  10              	#	–§–æ—Ä–º–∞—Ç–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∏—Ö –∞–¥—Ä–µ—Å–æ–≤ –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç
  11              	fmti:
  12 0008 256C6400 	        .string "%ld" 	# scanf: h - 8 –±–∏—Ç, u - –±–µ–∑–∑–Ω–∞–∫–æ–≤–æ–µ —Ü–µ–ª–æ–µ 
  13              	
  14              	fmtp:
  15 000c 256C750A 		.string "%lu\n"  # printf 
  15      00
  16              		
  17              	
  18              	.text        # —Å–µ–∫—Ü–∏—è –∫–æ–º–∞–Ω–¥ –ø—Ä–æ—Ü–µ—Å–æ—Ä–∞
  19              		
  20              	.type   Fact, @function
  21              	
  22              	Fact:
  23              	
  24              	#       –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ–ª–æ–≥ —Ñ—É–Ω—Ü–∏–∏
  25              	
  26 0000 55       	        pushl %ebp       # —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Å—Ç–µ–∫–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –±—ã–≤—à–µ–µ –≤ –≤—ã–
  27 0001 89E5     	        movl  %esp, %ebp # –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∞–¥—Ä–µ—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
  28              	                         # –ª–æ–∫–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω–Ω—ã–º –≤ —Å—Ç–µ–∫–µ –ø—É—Ç–µ–º –±–∞–
  29              				# –∞–¥—Ä–µ—Å–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ ebp
  30              	
  31              	
  32              	
  33              		
  34              	#       —Ç–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏
  35 0003 8B5D08   	        movl 8(%ebp), %ebx  # –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ ebx
  36              	
GAS LISTING task7.S 			page 3


  37 0006 83FB01   		cmpl $1, %ebx
  38 0009 7416     		je Fact1
  39              	
  40              		# –í—ã–∑–æ–≤ Fact
  41              		
  42 000b 4B       	        decl %ebx    # –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
  43 000c 53       		pushl %ebx
  44 000d E8EEFFFF 		call Fact
  44      FF
  45 0012 83C404   		addl $4, %esp   # –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–µ–∫–∞
  46              		
  47 0015 8B5D08   		movl 8(%ebp), %ebx  # –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ ebx
  48 0018 0FAFC3   		imull %ebx, %eax
  49              		
  50 001b 720B     		jc Fact_err
  51              		
  52              		#       –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —ç–ø–∏–ª–æ–≥ —Ñ—É–Ω–∫—Ü–∏–∏
  53              	FactEnd:	
  54 001d 89EC     	        movl %ebp, %esp # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–∫–∞
  55 001f 5D       	        popl %ebp       # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ebp
  56 0020 C3       	        ret             # –≤–æ–∑–≤—Ä–∞—Ç –≤ –≤—ã–∑—ã–≤–∞—é—â—É—é
  57              		
  58              	Fact1:
  59 0021 B8010000 		movl $1, %eax
  59      00
  60 0026 EBF5     		jmp FactEnd
  61              	Fact_err:
  62 0028 B8000000 		movl $0, %eax
  62      00
  63 002d EBEE     		jmp FactEnd
  64              	.global main # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - –≥–ª–æ–±–∞–ª—å–Ω–∞—è –º–µ—Ç–∫–∞
  65              	
  66              	main:
  67 002f 90       		nop
  68              	
  69              	#	–í—ã–∑–æ–≤—ã scanf  –¥–ª—è –≤–≤–æ–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–π 32 
  70              	#       –±–∏—Ç–æ–≤—ã—Ö —Ü–µ–ª—ã—Ö get –∏ put, —Ñ–æ—Ä–º–∞—Ç–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ fmtl        
  71              		
  72              		Puts "–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ:"
  72              	> .data
  72 0011 D092D0B2 	>  str0:.ascii "–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ:"
  72      D0B5D0B4 
  72      D0B8D182 
  72      D0B520D1 
  72      87D0B8D1 
  72              	>  
  72              	>  strlen0 =. - str0
  72              	> 
  72              	> .text
  72 0030 B8040000 	>  movl $4,%eax
  72      00
  72 0035 BB010000 	>  movl $1,%ebx
  72      00
  72 003a B9110000 	>  movl $str0,%ecx
  72      00
  72 003f BA1A0000 	>  movl $strlen0,%edx
  72      00
GAS LISTING task7.S 			page 4


  72 0044 CD80     	>  int $0x80
  73 0046 68000000 	        pushl $get	# 2 –ø–∞—Ä–∞–º–µ—Ç—Ä - –∞–¥—Ä–µ—Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
  73      00
  74 004b 68080000 	        pushl $fmti	# 1 –ø–∞—Ä–∞–º–µ—Ç—Ä - –∞–¥—Ä–µ—Å —Ñ–æ—Ä–º–∞—Ç–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
  74      00
  75 0050 E8FCFFFF 		call scanf           
  75      FF
  76 0055 83C408   		addl $8, %esp   # –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–µ–∫–∞
  77              		
  78              	#	–ø–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–∞
  79 0058 FF350000 		pushl get
  79      0000
  80 005e E89DFFFF 		call Fact
  80      FF
  81 0063 83C404   		addl $4, %esp   # –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–µ–∫–∞
  82 0066 A3040000 		movl %eax, put
  82      00
  83              	
  84 006b 83F800   		cmpl $0, %eax
  85 006e 7435     		je err
  86              	#	–ø–µ—á–∞—Ç—å —Å—É–º–º—ã
  87              	
  88              	        Puts "–§–∞–∫—Ç–æ—Ä–∏–∞–ª:"	
  88              	> .data
  88 002b D0A4D0B0 	>  str1:.ascii "–§–∞–∫—Ç–æ—Ä–∏–∞–ª:"
  88      D0BAD182 
  88      D0BED180 
  88      D0B8D0B0 
  88      D0BB3A
  88              	>  
  88              	>  strlen1 =. - str1
  88              	> 
  88              	> .text
  88 0070 B8040000 	>  movl $4,%eax
  88      00
  88 0075 BB010000 	>  movl $1,%ebx
  88      00
  88 007a B92B0000 	>  movl $str1,%ecx
  88      00
  88 007f BA130000 	>  movl $strlen1,%edx
  88      00
  88 0084 CD80     	>  int $0x80
  89 0086 FF350400 		pushl put              # 2 –ø–∞—Ä–∞–º–µ—Ç—Ä - –∑–Ω–∞—á–µ–Ω–∏–µ 
  89      0000
  90 008c 680C0000 		pushl $fmtp          # 1 –ø–∞—Ä–∞–º–µ—Ç—Ä - –∞–¥—Ä–µ—Å —Ñ–æ—Ä–º–∞—Ç–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ 
  90      00
  91 0091 E8FCFFFF 		call printf
  91      FF
  92              	
  93 0096 83C408   		addl $8, %esp        # –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–µ–∫–∞
  94              	
  95              	End:	
  96              		Finish
  96 0099 BB000000 	>  movl $0,%ebx
  96      00
  96 009e B8010000 	>  movl $1,%eax
  96      00
GAS LISTING task7.S 			page 5


  96 00a3 CD80     	>  int $0x80
  97              	err:
  98              		Puts "–û—à–∏–±–∫–∞: —á–∏—Å–ª–æ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ"
  98              	> .data
  98 003e D09ED188 	>  str3:.ascii "–û—à–∏–±–∫–∞: —á–∏—Å–ª–æ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ"
  98      D0B8D0B1 
  98      D0BAD0B0 
  98      3A20D187 
  98      D0B8D181 
  98              	>  
  98              	>  strlen3 =. - str3
  98              	> 
  98              	> .text
  98 00a5 B8040000 	>  movl $4,%eax
  98      00
  98 00aa BB010000 	>  movl $1,%ebx
  98      00
  98 00af B93E0000 	>  movl $str3,%ecx
  98      00
  98 00b4 BA360000 	>  movl $strlen3,%edx
  98      00
  98 00b9 CD80     	>  int $0x80
  99 00bb EBDC     		jmp End
 100              	.end
GAS LISTING task7.S 			page 6


DEFINED SYMBOLS
             task7.S:7      .data:0000000000000000 get
             task7.S:8      .data:0000000000000004 put
             task7.S:11     .data:0000000000000008 fmti
             task7.S:14     .data:000000000000000c fmtp
             task7.S:22     .text:0000000000000000 Fact
             task7.S:58     .text:0000000000000021 Fact1
             task7.S:61     .text:0000000000000028 Fact_err
             task7.S:53     .text:000000000000001d FactEnd
             task7.S:66     .text:000000000000002f main
             task7.S:72     .data:0000000000000011 str0
             task7.S:72     *ABS*:000000000000001a strlen0
             task7.S:97     .text:00000000000000a5 err
             task7.S:88     .data:000000000000002b str1
             task7.S:88     *ABS*:0000000000000013 strlen1
             task7.S:95     .text:0000000000000099 End
             task7.S:98     .data:000000000000003e str3
             task7.S:98     *ABS*:0000000000000036 strlen3

UNDEFINED SYMBOLS
scanf
printf
