GAS LISTING task5.S 			page 1


   1              	.include "my-macro"
   1              	/* –ú–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã */
   2              	
   3              	.macro Finish
   4              	    movl $0, %ebx 	# first argument: exit code
   5              	    movl $1, %eax 	# sys_exit index
   6              	    int  $0x80 		# kernel interrupt
   7              	.endm
   8              	
   9              	
  10              	/* 
  11              	 * –ú–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.
  12              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  13              	 * 	- –∫–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã
  14              	 *
  15              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  16              	 * –°–º. —Ç–∞–∫–∂–µ 'man 2 exit'
  17              	*/
  18              	.macro Exit ret_val
  19              		movl $1, %eax 		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ exit
  20              		movl \ret_val, %ebx 	# –∫–æ–¥ –≤—ã—Ö–æ–¥–∞
  21              		int $0x80 		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  22              	.endm
  23              	
  24              	
  25              	/*
  26              	 * –ú–∞—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ —Å–∏–
  27              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  28              	 * 	- –∞–¥—Ä–µ—Å –±—É—Ñ—Ñ–µ—Ä–∞ –¥–ª—è —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è —Å–∏–º–≤–æ–ª–∞
  29              	 * –†–µ–∑—É–ª—å—Ç–∞—Ç:
  30              	 *	- –≤ %eax –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
  31              	 *	- –ø–æ –∞–¥—Ä–µ—Å—É buf_addr - —Å—á–∏—Ç–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª
  32              	 * 
  33              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  34              	 * –°–º. —Ç–∞–∫–∂–µ 'man 2 read'
  35              	*/
  36              	.macro Getchar buf_addr
  37              		movl $3, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ read
  38              		movl $0, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤–≤–æ–¥–∞
  39              		movl \buf_addr, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ (–æ–Ω –∂–µ - —Ñ–∞–∫—Ç–∏—á–µ—Å–∫
  40              		     			# –ø–∞—Ä–∞–º–µ—Ç—Ä –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞)
  41              		movl $1, %edx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è —á—Ç–µ–Ω–∏—è
  42              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  43              	.endm
  44              	
  45              	/*
  46              	 * –ú–∞—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤—ã–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ –≤ —Å—Ç–∞–Ω–¥
  47              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  48              	 * 	- –°—Ç—Ä–æ–∫–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞.
  49              	 *
  50              	 * –ü—Ä–∏–º–µ—Ç—Ä –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞:
  51              	 *	Puts "–¢–µ–∫—Å—Ç –≤—ã–≤–æ–¥–∏–º–æ–π —Å—Ç—Ä–æ–∫–∏" 
  52              	 *
  53              	 * –†–µ–∑—É–ª—å—Ç–∞—Ç:
  54              	 *	- –≤—ã–≤–æ–¥–∏—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ —Å–∏–º–≤–æ–ª—ã –∑–∞–¥–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫
  55              	 *	  –∞ —Ç–∞–∫–∂–µ —Å–∏–º–≤–æ–ª –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏
  56              	 *	
GAS LISTING task5.S 			page 2


  57              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  58              	 * –°–º. —Ç–∞–∫–∂–µ 'man puts', 'man 2 write'
  59              	*/
  60              	.macro Puts string
  61              	.data
  62              	    str\@: 	.ascii "\string"  # —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª—è
  63              		
  64              	    strlen\@ = 	. - str\@           # –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫–∏
  65              	
  66              	.text
  67              		movl $4, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ write
  68              		movl $1, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞	
  69              		movl $str\@, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏ —Å –≤—ã–≤–æ–¥–∏–º—ã–º–∏ —Å–∏–º–≤–æ
  70              		movl $strlen\@, %edx 	# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞
  71              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  72              	.endm
  73              	
  74              	.macro ToString10 Numb
  75              	
  76              	        movw $10, %bx           # –°–∏—Å—Ç–µ–º–∞ —Å—á–∏—Å–ª–µ–Ω–∏—è. –ù–∞ –Ω–µ—ë –±—É–¥–µ–º –¥–µ–ª–
  77              	        movl $4, %esi           # –ê–¥—Ä–µ—Å —Å–∞–º–æ–≥–æ –ø–µ—Ä–≤–æ–≥–æ —á–∏–ª–∞. –í —á–∏—Å–ª–µ –Ω
  78              	        movw \Numb, %ax         # –ö–æ–ø–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä –≤ %ax
  79              	        xorl %edi, %edi         # –û–±–Ω—É–ª—è–µ–º %edi
  80              	
  81              	ToStr10_begin\@:                        # –ù–∞—á–∞–ª–æ —Ü–∏–∫–ª–∞
  82              	        movl $0, %edx           # –û–±–Ω—É–ª—è–µ–º %edx (–í –Ω—ë–º –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±—É
  83              	        divw %bx                # –î–µ–ª–∏–º %ax –Ω–∞ %bx, –æ—Å—Ç–∞—Ç–æ–∫ –≤ %dx
  84              	        addb $0x30, %dl         # –ü—Ä–∏–±–∞–≤–ª—è–µ–º –∫ %dl 0x30, —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –∫ –∫
  85              	        movb %dl, out(%esi)     # –ö–æ–ø–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ %dl –≤ –±—É—Ñ–µ—Ä –ø–æ –Ω—É
  86              	
  87              	        cmpw $0, %ax            # –î–æ—à–ª–∏ –¥–æ –Ω—É–ª—è? (–í %ax –ø—É—Å—Ç–æ?)
  88              	        je ToStr10_memcpy\@       # –î–∞, –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ–º –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
  89              	
  90              	        decl %esi               # –ù–µ—Ç, —É–º–µ–Ω—å—à–∞–µ–º %esi –Ω–∞ 1
  91              	        jmp ToStr10_begin\@       # –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–∞—á–∞–ª–æ —Ü–∏–∫–ª–∞
  92              	
  93              	ToStr10_memcpy\@:
  94              	        cmpl  $5, %esi          # –í %esi 5?
  95              	        je ToStr10_end\@          # –î–∞, –≤—ã—Ö–æ–¥–∏–º
  96              	
  97              	        movb out(%esi), %al # –ö–æ–ø–∏—Ä—É–µ–º –±–∞–π—Ç –ø–æ –∞–¥—Ä–µ—Å—É  String(%esi) –≤ %al
  98              	
  99              	        movb $0, out(%esi)  # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º 0 –ø–æ –∞–¥—Ä–µ—Å—É String(%esi)
 100              	        movb %al, out(%edi) # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ %al –ø–æ –∞–¥—Ä–µ—Å—É String(%e
 101              	        inc %esi                # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º %esi –Ω–∞ 1
 102              	        inc %edi                # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º %edi –Ω–∞ 1
 103              	        jmp ToStr10_memcpy\@    # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–∞—á–∞–ª–æ —Ü–∏–∫–ª–∞
 104              	
 105              	ToStr10_end\@:
 106              	        movb $0, out(%edi)
 107              	        Write out
 108              	        movw $0, summ
 109              	.endm
 110              	
   2              	.include "my-func"
   1              	# –ú–∞–∫—Ä–æ—Å –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –¥–ª–∏–Ω–Ω—ã —Å—Ç—Ä–æ–∫–∏(—Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ %edx). –ö–æ–
   2              	.macro Strlen str
GAS LISTING task5.S 			page 3


   3              		xorl %edx, %edx		# –û–±–Ω—É–ª—è–µ–º %edx.
   4              	
   5              	strlen_begin\@:
   6              		
   7              		movb \str(%edx), %al	# –ö–æ–ø–∏—Ä—É–µ–º –±–∞–π—Ç —Å—Ç—Ä–æ–∫–∏ –≤ %al.
   8              		cmpb $0, %al		# –°–∏–º–≤–æ–ª –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏?
   9              		je strlen_end\@		# –î–∞, –≤—ã—Ö–æ–¥–∏–º.
  10              		incl %edx		# –ù–µ—Ç, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º %edx –Ω–∞ 1 ...
  11              		jmp strlen_begin\@	# –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–∞—á–∞–ª–æ —Ü–∏–∫–ª–∞
  12              		
  13              	strlen_end\@:	
  14              	.endm
  15              	
  16              	
  17              	# –ú–∞–∫—Ä–æ—Å –≤—ã–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
  18              	.macro Write string
  19              	
  20              		Strlen \string
  21              		movl $4, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ write
  22              		movl $1, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞	
  23              		movl $\string, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏ —Å –≤—ã–≤–æ–¥–∏–º—ã–º–∏ —Å–∏–º–≤
  24              	
  25              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  26              	
  27              	.endm
   3              	
   4              	.data
   5              	
   6 0000 30       	delta:  .byte 0x30
   7              	
   8              	.bss
   9              	
  10              	        .lcomm summ, 2          # –°—É–º–º–∞
  11              	        .lcomm out, 6           # –í—ã–≤–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω
  12              	        .lcomm c, 1             # –ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª
  13              	        .lcomm array, 65535         # –ë—É—Ñ–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–∏—Ñ—Ä
  14              	        .lcomm arr_size, 65535  # –°–∫–æ–ª—å–∫–æ –∑–∞–Ω—è—Ç–æ –ø–∞–º—è—Ç–∏ –≤ –º–∞—Å—Å–∏–≤–µ
  15              	        .lcomm step, 1          # –®–∞–≥
  16              	
  17              	.text
  18              	
  19              	.global _start                  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –æ–±—ä—è–≤–ª–µ–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –º–
  20              	
  21              	_start:                         # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
  22              	
  23              	input:
  24              	        Puts "–í–≤–µ–¥–∏—Ç–µ —Ü–∏—Ñ—Ä—ã\n"
  24              	> .data
  24 0001 D092D0B2 	>  str0:.ascii "–í–≤–µ–¥–∏—Ç–µ —Ü–∏—Ñ—Ä—ã\n"
  24      D0B5D0B4 
  24      D0B8D182 
  24      D0B520D1 
  24      86D0B8D1 
  24              	>  
  24              	>  strlen0 =. - str0
  24              	> 
  24              	> .text
GAS LISTING task5.S 			page 4


  24 0000 B8040000 	>  movl $4,%eax
  24      00
  24 0005 BB010000 	>  movl $1,%ebx
  24      00
  24 000a B9010000 	>  movl $str0,%ecx
  24      00
  24 000f BA1A0000 	>  movl $strlen0,%edx
  24      00
  24 0014 CD80     	>  int $0x80
  25              	show_prompt:
  26              	        Getchar $c              # –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤ –≤–≤–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ —Å–æ —Å—Ç–∞–Ω–¥–∞—
  26 0016 B8030000 	>  movl $3,%eax
  26      00
  26 001b BB000000 	>  movl $0,%ebx
  26      00
  26 0020 B90A0000 	>  movl $c,%ecx
  26      00
  26              	>  
  26 0025 BA010000 	>  movl $1,%edx
  26      00
  26 002a CD80     	>  int $0x80
  27              	
  28 002c 83F800   	        cmpl $0, %eax           # –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª - EOF (–≤–≤–µ–¥–µ–Ω–æ 0 —Å–∏–º–≤–æ–ª–æ–≤) ?
  29 002f 0F849000 	        je exit_succesful       # –î–∞ - –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
  29      0000
  30              	
  31 0035 803D0A00 	        cmpb $'\n', c           # —ç—Ç–æ —Å–∏–º–≤–æ–ª –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ ?
  31      00000A
  32 003c 7440     	        je print_sum            # –î–∞ - –Ω–∞ –ø—Ä–∏–±–∞–≤–ª–µ–Ω–∏–µ —á–∏—Å–ª–∞ –∫  —Å—É–º–º–µ
  33              	
  34 003e 803D0A00 	        cmpb $'9', c            # –∫–æ–¥ –±–æ–ª—å—à–µ –∫–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ '9' ?
  34      000039
  35 0045 7741     	        ja print_err_msg        # –î–ê - –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
  36 0047 803D0A00 	        cmpb $'0', c            # –∫–æ–¥ –º–µ–Ω—å—à–µ –∫–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ '0' ?
  36      000030
  37 004e 7238     	        jb print_err_msg        # –î–ê - –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
  38              	
  39 0050 813D1000 	        cmpl $65535, arr_size   # –ü—Ä–æ–≤–µ—Ä—è–µ–º  —Ä–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞
  39      0100FFFF 
  39      0000
  40 005a 7447     	        je err_memory_over	# –ë–æ–ª—å—à–µ 65535? –î–∞ - –≤—ã–≤–æ–¥ –æ—à–∏–±–∫–∏.–í—ã—Ö–æ–¥.
  41              	
  42 005c 6631C0   	        xorw %ax, %ax		# –û–±–Ω—É–ª—è–µ–º 
  43              	
  44 005f A00A0000 	        movb c, %al             # –∫–æ–¥ –∏–∑ n –ø–∏—à–µ–º –≤ %al
  44      00
  45 0064 2C30     	        subb $0x30, %al         # –ü–æ–ª—É—á–∞–µ–º —á–∏—Å–ª–æ –∏–∑ –∫–æ–¥–∞
  46 0066 668B3510 	        movw arr_size, %si      # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –≤ –º–∞—Å—Å–∏–≤–µ
  46      000100
  47 006d 88861000 	        movb %al, array(%esi)   # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∏–∑ %al –≤ array –ø–æ –∞–¥—Ä–µ—Å—É %esi
  47      0000
  48 0073 6646     	        incw %si                # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º %si –Ω–∞ 1
  49 0075 66893510 	        movw %si, arr_size      # –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω
  49      000100
  50              	
  51 007c EB98     	        jmp show_prompt		# –ü–µ—Ä–µ—Ö–æ–¥ –∫ –Ω–∞—á–∞–ª—É
  52              	
GAS LISTING task5.S 			page 5


  53              	print_sum:
  54 007e E8AA0000 	        call print_summ         # –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≤—ã–≤–æ–¥–∞ —Å—É–º–º—ã
  54      00
  55              	
  56 0083 E978FFFF 	        jmp input               # –ü–µ—Ä–µ—Ö–æ–¥ –∫ –Ω–∞—á–∞–ª—É
  56      FF
  57              	
  58              	print_err_msg:
  59              	        Puts "–ù–µ —Ü–∏—Ñ—Ä–æ–≤–∞—è –∫–ª–∞–≤–∏—à–∞. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –≤–≤–æ–¥\n"    # –≤—ã–≤–æ–¥ 
  59              	> .data
  59 001b D09DD0B5 	>  str2:.ascii "–ù–µ —Ü–∏—Ñ—Ä–æ–≤–∞—è –∫–ª–∞–≤–∏—à–∞. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –≤–≤–æ–¥\n"
  59      20D186D0 
  59      B8D184D1 
  59      80D0BED0 
  59      B2D0B0D1 
  59              	>  
  59              	>  strlen2 =. - str2
  59              	> 
  59              	> .text
  59 0088 B8040000 	>  movl $4,%eax
  59      00
  59 008d BB010000 	>  movl $1,%ebx
  59      00
  59 0092 B91B0000 	>  movl $str2,%ecx
  59      00
  59 0097 BA420000 	>  movl $strlen2,%edx
  59      00
  59 009c CD80     	>  int $0x80
  60              	 
  61 009e E973FFFF 	        jmp show_prompt         # –Ω–∞ –≤–≤–æ–¥ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞
  61      FF
  62              	
  63              	err_memory_over:
  64              	        Puts "–ú–∞—Å—Å–∏–≤ –∑–∞–ø–æ–ª–Ω–µ–Ω\n"        # –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±
  64              	> .data
  64 005d D09CD0B0 	>  str3:.ascii "–ú–∞—Å—Å–∏–≤ –∑–∞–ø–æ–ª–Ω–µ–Ω\n"
  64      D181D181 
  64      D0B8D0B2 
  64      20D0B7D0 
  64      B0D0BFD0 
  64              	>  
  64              	>  strlen3 =. - str3
  64              	> 
  64              	> .text
  64 00a3 B8040000 	>  movl $4,%eax
  64      00
  64 00a8 BB010000 	>  movl $1,%ebx
  64      00
  64 00ad B95D0000 	>  movl $str3,%ecx
  64      00
  64 00b2 BA1E0000 	>  movl $strlen3,%edx
  64      00
  64 00b7 CD80     	>  int $0x80
  65              	        Exit $0
  65 00b9 B8010000 	>  movl $1,%eax
  65      00
  65 00be BB000000 	>  movl $0,%ebx
GAS LISTING task5.S 			page 6


  65      00
  65 00c3 CD80     	>  int $0x80
  66              	
  67              	exit_succesful:
  68 00c5 E8630000 	        call print_summ         # –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≤—ã–≤–æ–¥–∞ —Å—É–º–º—ã
  68      00
  69              		Exit $0
  69 00ca B8010000 	>  movl $1,%eax
  69      00
  69 00cf BB000000 	>  movl $0,%ebx
  69      00
  69 00d4 CD80     	>  int $0x80
  70              	
  71              	
  72              	
  73              	
  74              	update_summ:
  75 00d6 31F6     	        xorl %esi, %esi         # –û–±–Ω—É–ª—è–µ–º %esi
  76 00d8 668B350F 	        movw step, %si          # –ö–æ–ø–∏—Ä—É–µ–º —à–∞–≥ –≤ %esi
  76      000200
  77              	
  78 00df 4E       	        decl %esi               # –£–º–µ–Ω—å—à–∞–µ–º %esi –Ω–∞ 1 (–Ω—É–ª–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç –±—
  79              	
  80 00e0 31C0     	        xorl %eax, %eax         # –û–±–Ω—É–ª—è–µ–º %eax
  81 00e2 66C70500 	        movw $0, summ           # –û–±–Ω—É–ª—è–µ–º summ
  81      00000000 
  81      00
  82              	
  83              	update_begin:
  84 00eb 3B351000 	        cmpl arr_size, %esi     # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞ —Å–æ —Å–ª–µ–¥—É—
  84      0100
  85 00f1 7F17     	        jg update_exit
  86              	
  87 00f3 8A861000 	        movb array(%esi), %al   # –ö–æ–ø–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ –≤ %al
  87      0000
  88 00f9 66010500 	        addw %ax, summ          # –ü—Ä–∏–±–∞–≤–ª—è–µ–º %ax –∫ summ
  88      000000
  89 0100 7209     	        jc err_over             # –í—ã—Ö–æ–¥, –µ—Å–ª–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ
  90              	
  91 0102 03350F00 	        addl step, %esi         # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—â–µ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
  91      0200
  92 0108 EBE1     	        jmp update_begin
  93              	
  94              	update_exit:
  95 010a C3       	        ret                     # –≤—ã—Ö–æ–¥–∏–º
  96              	
  97              	err_over:
  98              	        Puts "–ü—Ä–æ–∏–∑–æ—à–ª–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ. –í—ã—Ö–æ–¥.\n" # –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ
  98              	> .data
  98 007b D09FD180 	>  str6:.ascii "–ü—Ä–æ–∏–∑–æ—à–ª–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ. –í—ã—Ö–æ–¥.\n"
  98      D0BED0B8 
  98      D0B7D0BE 
  98      D188D0BB 
  98      D0BE20D0 
  98              	>  
  98              	>  strlen6 =. - str6
  98              	> 
GAS LISTING task5.S 			page 7


  98              	> .text
  98 010b B8040000 	>  movl $4,%eax
  98      00
  98 0110 BB010000 	>  movl $1,%ebx
  98      00
  98 0115 B97B0000 	>  movl $str6,%ecx
  98      00
  98 011a BA390000 	>  movl $strlen6,%edx
  98      00
  98 011f CD80     	>  int $0x80
  99              	        Exit $1
  99 0121 B8010000 	>  movl $1,%eax
  99      00
  99 0126 BB010000 	>  movl $1,%ebx
  99      00
  99 012b CD80     	>  int $0x80
 100              	
 101              	
 102              	
 103              	
 104              	
 105              	print_summ:
 106              	        Puts "–°—É–º–º–∞ —Ü–∏—Ñ—Ä, –Ω–∞ –ø–æ–∑–∏—Ü–∏—è—Ö –∫—Ä–∞—Ç–Ω—ã–º: \n"
 106              	> .data
 106 00b4 D0A1D183 	>  str8:.ascii "–°—É–º–º–∞ —Ü–∏—Ñ—Ä, –Ω–∞ –ø–æ–∑–∏—Ü–∏—è—Ö –∫—Ä–∞—Ç–Ω—ã–º: \n"
 106      D0BCD0BC 
 106      D0B020D1 
 106      86D0B8D1 
 106      84D1802C 
 106              	>  
 106              	>  strlen8 =. - str8
 106              	> 
 106              	> .text
 106 012d B8040000 	>  movl $4,%eax
 106      00
 106 0132 BB010000 	>  movl $1,%ebx
 106      00
 106 0137 B9B40000 	>  movl $str8,%ecx
 106      00
 106 013c BA3C0000 	>  movl $strlen8,%edx
 106      00
 106 0141 CD80     	>  int $0x80
 107              	
 108 0143 66C7050F 	        movw $2, step           # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —à–∞–≥ –¥–ª—è –≤—ã—á–∏—Å–
 108      00020002 
 108      00
 109              	
 110              	print_begin:
 111              	        ToString10 step         # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —à–∞–≥ –≤ —Å–∏–º–≤–æ–ª
 111              	> 
 111 014c 66BB0A00 	>  movw $10,%bx
 111 0150 BE040000 	>  movl $4,%esi
 111      00
 111 0155 66A10F00 	>  movw step,%ax
 111      0200
 111 015b 31FF     	>  xorl %edi,%edi
 111              	> 
GAS LISTING task5.S 			page 8


 111              	> ToStr10_begin9:
 111 015d BA000000 	>  movl $0,%edx
 111      00
 111 0162 66F7F3   	>  divw %bx
 111 0165 80C230   	>  addb $0x30,%dl
 111 0168 88960400 	>  movb %dl,out(%esi)
 111      0000
 111              	> 
 111 016e 6683F800 	>  cmpw $0,%ax
 111 0172 7403     	>  je ToStr10_memcpy9
 111              	> 
 111 0174 4E       	>  decl %esi
 111 0175 EBE6     	>  jmp ToStr10_begin9
 111              	> 
 111              	> ToStr10_memcpy9:
 111 0177 83FE05   	>  cmpl $5,%esi
 111 017a 7417     	>  je ToStr10_end9
 111              	> 
 111 017c 8A860400 	>  movb out(%esi),%al
 111      0000
 111              	> 
 111 0182 C6860400 	>  movb $0,out(%esi)
 111      000000
 111 0189 88870400 	>  movb %al,out(%edi)
 111      0000
 111 018f 46       	>  inc %esi
 111 0190 47       	>  inc %edi
 111 0191 EBE4     	>  jmp ToStr10_memcpy9
 111              	> 
 111              	> ToStr10_end9:
 111 0193 C6870400 	>  movb $0,out(%edi)
 111      000000
 111              	>  Write out
 111              	>> 
 111              	>>  Strlen out
 111 019a 31D2     	>>>  xorl %edx,%edx
 111              	>>> 
 111              	>>> strlen_begin11:
 111              	>>>  
 111 019c 8A820400 	>>>  movb out(%edx),%al
 111      0000
 111 01a2 3C00     	>>>  cmpb $0,%al
 111 01a4 7403     	>>>  je strlen_end11
 111 01a6 42       	>>>  incl %edx
 111 01a7 EBF3     	>>>  jmp strlen_begin11
 111              	>>>  
 111              	>>> strlen_end11:
 111 01a9 B8040000 	>>  movl $4,%eax
 111      00
 111 01ae BB010000 	>>  movl $1,%ebx
 111      00
 111 01b3 B9040000 	>>  movl $out,%ecx
 111      00
 111              	>> 
 111 01b8 CD80     	>>  int $0x80
 111              	>> 
 111 01ba 66C70500 	>  movw $0,summ
GAS LISTING task5.S 			page 9


 111      00000000 
 111      00
 112              	        Puts "-–º(–º–∏):  "	# –í—ã–≤–æ–¥–∏–º –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
 112              	> .data
 112 00f0 2DD0BC28 	>  str12:.ascii "-–º(–º–∏):  "
 112      D0BCD0B8 
 112      293A2020 
 112              	>  
 112              	>  strlen12 =. - str12
 112              	> 
 112              	> .text
 112 01c3 B8040000 	>  movl $4,%eax
 112      00
 112 01c8 BB010000 	>  movl $1,%ebx
 112      00
 112 01cd B9F00000 	>  movl $str12,%ecx
 112      00
 112 01d2 BA0C0000 	>  movl $strlen12,%edx
 112      00
 112 01d7 CD80     	>  int $0x80
 113              	
 114 01d9 E8F8FEFF 	        call update_summ        #  –£–∑–Ω–∞—ë–º —Å—É–º–º—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤
 114      FF
 115              	        ToString10 summ         # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—É–º–º—É –≤ —Å–∏–º–≤–æ–ª—ã
 115              	> 
 115 01de 66BB0A00 	>  movw $10,%bx
 115 01e2 BE040000 	>  movl $4,%esi
 115      00
 115 01e7 66A10000 	>  movw summ,%ax
 115      0000
 115 01ed 31FF     	>  xorl %edi,%edi
 115              	> 
 115              	> ToStr10_begin13:
 115 01ef BA000000 	>  movl $0,%edx
 115      00
 115 01f4 66F7F3   	>  divw %bx
 115 01f7 80C230   	>  addb $0x30,%dl
 115 01fa 88960400 	>  movb %dl,out(%esi)
 115      0000
 115              	> 
 115 0200 6683F800 	>  cmpw $0,%ax
 115 0204 7403     	>  je ToStr10_memcpy13
 115              	> 
 115 0206 4E       	>  decl %esi
 115 0207 EBE6     	>  jmp ToStr10_begin13
 115              	> 
 115              	> ToStr10_memcpy13:
 115 0209 83FE05   	>  cmpl $5,%esi
 115 020c 7417     	>  je ToStr10_end13
 115              	> 
 115 020e 8A860400 	>  movb out(%esi),%al
 115      0000
 115              	> 
 115 0214 C6860400 	>  movb $0,out(%esi)
 115      000000
 115 021b 88870400 	>  movb %al,out(%edi)
 115      0000
GAS LISTING task5.S 			page 10


 115 0221 46       	>  inc %esi
 115 0222 47       	>  inc %edi
 115 0223 EBE4     	>  jmp ToStr10_memcpy13
 115              	> 
 115              	> ToStr10_end13:
 115 0225 C6870400 	>  movb $0,out(%edi)
 115      000000
 115              	>  Write out
 115              	>> 
 115              	>>  Strlen out
 115 022c 31D2     	>>>  xorl %edx,%edx
 115              	>>> 
 115              	>>> strlen_begin15:
 115              	>>>  
 115 022e 8A820400 	>>>  movb out(%edx),%al
 115      0000
 115 0234 3C00     	>>>  cmpb $0,%al
 115 0236 7403     	>>>  je strlen_end15
 115 0238 42       	>>>  incl %edx
 115 0239 EBF3     	>>>  jmp strlen_begin15
 115              	>>>  
 115              	>>> strlen_end15:
 115 023b B8040000 	>>  movl $4,%eax
 115      00
 115 0240 BB010000 	>>  movl $1,%ebx
 115      00
 115 0245 B9040000 	>>  movl $out,%ecx
 115      00
 115              	>> 
 115 024a CD80     	>>  int $0x80
 115              	>> 
 115 024c 66C70500 	>  movw $0,summ
 115      00000000 
 115      00
 116              	        Puts "\n"
 116              	> .data
 116 00fc 0A       	>  str16:.ascii "\n"
 116              	>  
 116              	>  strlen16 =. - str16
 116              	> 
 116              	> .text
 116 0255 B8040000 	>  movl $4,%eax
 116      00
 116 025a BB010000 	>  movl $1,%ebx
 116      00
 116 025f B9FC0000 	>  movl $str16,%ecx
 116      00
 116 0264 BA010000 	>  movl $strlen16,%edx
 116      00
 116 0269 CD80     	>  int $0x80
 117              	
 118              	step_choose:			# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á
 119              	
 120 026b 833D0F00 	        cmpl $2, step		# step = 2?
 120      020002
 121 0272 742F     		je step3		# –ø–µ—Ä–µ—Ö–æ–¥ –∫ step3
 122              	
GAS LISTING task5.S 			page 11


 123 0274 833D0F00 	        cmpl $3, step
 123      020003
 124 027b 7434     	        je step4
 125              	
 126 027d 833D0F00 	        cmpl $4, step
 126      020004
 127 0284 7439     	        je step8
 128              	
 129 0286 66C70500 		movw $0, summ		# –û–±–Ω—É–ª—è–µ–º –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –Ω–∞–±–æ
 129      00000000 
 129      00
 130 028f 66C70510 		movw $0, array
 130      00000000 
 130      00
 131 0298 66C70510 		movw $0, arr_size
 131      00010000 
 131      00
 132 02a1 EB2A     	        jmp print_exit          # –ü—Ä–æ—à–ª–∏ –≤—Å–µ —à–∞–≥–∏, –≤—ã—Ö–æ–¥–∏–º
 133              	
 134              	step3:
 135 02a3 66C7050F 	        movw $3, step		# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —à–∞–≥–∞ 
 135      00020003 
 135      00
 136 02ac E99BFEFF 	        jmp print_begin		# –ü–µ—Ä–µ—Ö–æ–¥ –∫ –Ω–∞—á–∞–ª—É –≤—ã–≤–æ–¥–∞ —Å—É–º–º—ã
 136      FF
 137              	
 138              	step4:
 139 02b1 66C7050F 	        movw $4, step
 139      00020004 
 139      00
 140 02ba E98DFEFF 	        jmp print_begin
 140      FF
 141              	
 142              	step8:
 143 02bf 66C7050F 	        movw $8, step
 143      00020008 
 143      00
 144 02c8 E97FFEFF 	        jmp print_begin
 144      FF
 145              	
 146              	print_exit:
 147 02cd C3       	        ret                     # –í—ã—Ö–æ–¥ –∏–∑ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
 148              	
 149              	
 150              	.end
GAS LISTING task5.S 			page 12


DEFINED SYMBOLS
             task5.S:6      .data:0000000000000000 delta
             task5.S:10     .bss:0000000000000000 summ
             task5.S:11     .bss:0000000000000004 out
             task5.S:11     .bss:000000000000000a c
             task5.S:13     .bss:0000000000000010 array
             task5.S:14     .bss:0000000000010010 arr_size
             task5.S:14     .bss:000000000002000f step
             task5.S:21     .text:0000000000000000 _start
             task5.S:23     .text:0000000000000000 input
             task5.S:24     .data:0000000000000001 str0
             task5.S:24     *ABS*:000000000000001a strlen0
             task5.S:25     .text:0000000000000016 show_prompt
             task5.S:67     .text:00000000000000c5 exit_succesful
             task5.S:53     .text:000000000000007e print_sum
             task5.S:58     .text:0000000000000088 print_err_msg
             task5.S:63     .text:00000000000000a3 err_memory_over
             task5.S:105    .text:000000000000012d print_summ
             task5.S:59     .data:000000000000001b str2
             task5.S:59     *ABS*:0000000000000042 strlen2
             task5.S:64     .data:000000000000005d str3
             task5.S:64     *ABS*:000000000000001e strlen3
             task5.S:74     .text:00000000000000d6 update_summ
             task5.S:83     .text:00000000000000eb update_begin
             task5.S:94     .text:000000000000010a update_exit
             task5.S:97     .text:000000000000010b err_over
             task5.S:98     .data:000000000000007b str6
             task5.S:98     *ABS*:0000000000000039 strlen6
             task5.S:106    .data:00000000000000b4 str8
             task5.S:106    *ABS*:000000000000003c strlen8
             task5.S:110    .text:000000000000014c print_begin
             task5.S:111    .text:000000000000015d ToStr10_begin9
             task5.S:111    .text:0000000000000177 ToStr10_memcpy9
             task5.S:111    .text:0000000000000193 ToStr10_end9
             task5.S:111    .text:000000000000019c strlen_begin11
             task5.S:111    .text:00000000000001a9 strlen_end11
             task5.S:112    .data:00000000000000f0 str12
             task5.S:112    *ABS*:000000000000000c strlen12
             task5.S:115    .text:00000000000001ef ToStr10_begin13
             task5.S:115    .text:0000000000000209 ToStr10_memcpy13
             task5.S:115    .text:0000000000000225 ToStr10_end13
             task5.S:115    .text:000000000000022e strlen_begin15
             task5.S:115    .text:000000000000023b strlen_end15
             task5.S:116    .data:00000000000000fc str16
             task5.S:116    *ABS*:0000000000000001 strlen16
             task5.S:118    .text:000000000000026b step_choose
             task5.S:134    .text:00000000000002a3 step3
             task5.S:138    .text:00000000000002b1 step4
             task5.S:142    .text:00000000000002bf step8
             task5.S:146    .text:00000000000002cd print_exit

NO UNDEFINED SYMBOLS
